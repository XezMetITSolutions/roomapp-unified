
<!DOCTYPE html>
<html>
<head>
    <title>Backend Direkt Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .error { color: #d32f2f; }
        .success { color: #388e3c; }
        .warning { color: #f57c00; }
    </style>
</head>
<body>
    <h1>ğŸ” Backend Direkt Test</h1>
    
    <div class="test-box">
        <h2>Test 1: Backend Health Check (No CORS)</h2>
        <p>Bu test CORS olmadan backend'e direkt baÄŸlanmayÄ± dener.</p>
        <button onclick="testBackendNoCors()">Test Et</button>
        <pre id="result1">HenÃ¼z test edilmedi...</pre>
    </div>

    <div class="test-box">
        <h2>Test 2: Backend Health Check (With CORS)</h2>
        <p>Bu test CORS ile backend'e baÄŸlanmayÄ± dener (normal durum).</p>
        <button onclick="testBackendWithCors()">Test Et</button>
        <pre id="result2">HenÃ¼z test edilmedi...</pre>
    </div>

    <div class="test-box">
        <h2>Test 3: Backend Render URL'si</h2>
        <p>Backend'in Render URL'sini yeni sekmede aÃ§ar.</p>
        <button onclick="openBackend()">Backend'i AÃ§</button>
        <p class="warning">Not: EÄŸer 404 alÄ±rsanÄ±z, backend Ã§alÄ±ÅŸmÄ±yor demektir.</p>
    </div>

    <div class="test-box">
        <h2>ğŸ“‹ SonuÃ§ ve Ã–neriler</h2>
        <div id="recommendations">
            <p>Testleri Ã§alÄ±ÅŸtÄ±rÄ±n...</p>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'https://roomapp-backend.onrender.com';

        async function testBackendNoCors() {
            const resultEl = document.getElementById('result1');
            resultEl.textContent = 'â³ Test ediliyor...';
            
            try {
                const response = await fetch(`${BACKEND_URL}/health`, {
                    method: 'GET',
                    mode: 'no-cors' // CORS bypass
                });
                
                resultEl.innerHTML = `<span class="warning">âš ï¸ UYARI: no-cors mode</span>\n\n` +
                    `Status: ${response.status} (opaque response)\n` +
                    `Type: ${response.type}\n\n` +
                    `Bu sonuÃ§ backend'in Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± gÃ¶sterir ama CORS ayarlarÄ±nÄ± test edemez.\n` +
                    `EÄŸer bu baÅŸarÄ±lÄ± ise, backend Ã§alÄ±ÅŸÄ±yor ama CORS ayarlarÄ± yanlÄ±ÅŸ.`;
                
                updateRecommendations('no-cors-success');
            } catch (error) {
                resultEl.innerHTML = `<span class="error">âŒ HATA</span>\n\n` +
                    `Error: ${error.message}\n\n` +
                    `Backend'e hiÃ§ ulaÅŸÄ±lamÄ±yor. Backend servisi Ã§alÄ±ÅŸmÄ±yor olabilir.`;
                
                updateRecommendations('no-cors-fail');
            }
        }

        async function testBackendWithCors() {
            const resultEl = document.getElementById('result2');
            resultEl.textContent = 'â³ Test ediliyor...';
            
            console.log('ğŸ” Testing with CORS...');
            console.log('Origin:', window.location.origin);
            console.log('Backend URL:', BACKEND_URL);
            
            try {
                const response = await fetch(`${BACKEND_URL}/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    mode: 'cors',
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                resultEl.innerHTML = `<span class="success">âœ… BAÅARILI!</span>\n\n` +
                    `Status: ${response.status}\n` +
                    `Response:\n${JSON.stringify(data, null, 2)}\n\n` +
                    `CORS Ã§alÄ±ÅŸÄ±yor! Backend doÄŸru yapÄ±landÄ±rÄ±lmÄ±ÅŸ.`;
                
                updateRecommendations('cors-success');
            } catch (error) {
                console.error('âŒ CORS Test Failed:', error);
                
                resultEl.innerHTML = `<span class="error">âŒ CORS HATASI!</span>\n\n` +
                    `Error: ${error.message}\n` +
                    `Error Type: ${error.constructor.name}\n\n` +
                    `Origin: ${window.location.origin}\n` +
                    `Backend: ${BACKEND_URL}\n\n` +
                    `Bu hata, backend'in CORS ayarlarÄ±nÄ±n yanlÄ±ÅŸ olduÄŸunu gÃ¶sterir.\n` +
                    `Backend'in origin '${window.location.origin}' adresine izin vermesi gerekiyor.`;
                
                updateRecommendations('cors-fail');
            }
        }

        function openBackend() {
            window.open(`${BACKEND_URL}/health`, '_blank');
        }

        function updateRecommendations(testResult) {
            const recEl = document.getElementById('recommendations');
            
            switch(testResult) {
                case 'no-cors-success':
                    recEl.innerHTML = `
                        <p class="warning"><strong>âš ï¸ Backend Ã§alÄ±ÅŸÄ±yor ama CORS testi gerekli</strong></p>
                        <p>Test 2'yi Ã§alÄ±ÅŸtÄ±rÄ±n (With CORS).</p>
                    `;
                    break;
                    
                case 'no-cors-fail':
                    recEl.innerHTML = `
                        <p class="error"><strong>âŒ Backend Ã§alÄ±ÅŸmÄ±yor!</strong></p>
                        <ol>
                            <li>Render.com'a gidin: <a href="https://dashboard.render.com" target="_blank">https://dashboard.render.com</a></li>
                            <li>Backend servisini bulun (roomapp-backend)</li>
                            <li>Servis durumunu kontrol edin (Live/Failed?)</li>
                            <li>EÄŸer Failed ise, loglarÄ± kontrol edin</li>
                            <li>"Manual Deploy" â†’ "Deploy latest commit" yapÄ±n</li>
                        </ol>
                    `;
                    break;
                    
                case 'cors-success':
                    recEl.innerHTML = `
                        <p class="success"><strong>âœ… HER ÅEY Ã‡ALIÅIYOR!</strong></p>
                        <p>Backend doÄŸru yapÄ±landÄ±rÄ±lmÄ±ÅŸ ve CORS Ã§alÄ±ÅŸÄ±yor.</p>
                        <p>EÄŸer ana uygulamada hala sorun varsa, frontend'i kontrol edin.</p>
                    `;
                    break;
                    
                case 'cors-fail':
                    recEl.innerHTML = `
                        <p class="error"><strong>âŒ CORS AYARLARI YANLIÅ!</strong></p>
                        <p><strong>Sorun:</strong> Backend Ã§alÄ±ÅŸÄ±yor ama origin '${window.location.origin}' adresine izin vermiyor.</p>
                        <p><strong>Ã‡Ã¶zÃ¼m:</strong></p>
                        <ol>
                            <li>Backend kodu GitHub'da gÃ¼ncel mi kontrol edin (Commit: 5d4b6c1 veya a5aef33)</li>
                            <li>Render.com'da backend'i yeniden deploy edin</li>
                            <li>Deploy sonrasÄ± backend loglarÄ±nÄ± kontrol edin:
                                <ul>
                                    <li>Åunu gÃ¶rmeli: "ğŸ” CORS: Checking origin: ${window.location.origin}"</li>
                                    <li>Åunu gÃ¶rmeli: "âœ… CORS: Allowed origin ${window.location.origin}"</li>
                                </ul>
                            </li>
                        </ol>
                        <p class="warning"><strong>Ã–NEMLÄ°:</strong> Backend'i Render.com'da deploy etmeyi unutmayÄ±n!</p>
                    `;
                    break;
            }
        }
    </script>
</body>
</html>
